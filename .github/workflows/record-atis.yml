name: Enregistrement ATIS

on:
  schedule:
    - cron: '22,52 * * * *'   # toutes les 30 minutes
  workflow_dispatch:

jobs:
  record-atis:
    runs-on: ubuntu-22.04

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Installer ffmpeg et curl
        run: |
          sudo apt-get update -qq
          sudo apt-get install -y ffmpeg curl

      - name: Enregistrer le flux ATIS en MP3
        run: |
          curl -s -A "Mozilla/5.0" -e "https://www.liveatc.net/" \
          "https://s1-fmt2.liveatc.net/eetn2_atis" \
          | ffmpeg -i pipe:0 -t 120 -y atis_tallinn.mp3

      - name: Convertir MP3 en WAV mono 16kHz
        run: |
          ffmpeg -i atis_tallinn.mp3 -ac 1 -ar 16000 atis_tallinn.wav

      - name: Upload audio comme artefact
        uses: actions/upload-artifact@v4
        with:
          name: atis-audio
          path: |
            atis_tallinn.mp3
            atis_tallinn.wav

name: Transcription ATIS avec Whisper

on:
  workflow_dispatch:

jobs:
  transcribe-atis:
    runs-on: ubuntu-22.04

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # Installer ffmpeg et dépendances système
      - name: Installer ffmpeg
        run: |
          sudo apt-get update -qq
          sudo apt-get install -y ffmpeg

      # Installer Python et créer un environnement virtuel
      - name: Setup Python et venv
        uses: actions/setup-python@v4
        with:
          python-version: 3.12
      - run: |
          python -m venv venv
          source venv/bin/activate
          pip install --upgrade pip
          pip install openai-whisper

      # Transcrire l'audio ATIS
      - name: Transcrire ATIS avec Whisper
        run: |
          source venv/bin/activate
          whisper atis_tallinn.wav --model small --language fr --output_format txt --output_dir .

      # Vérifier le fichier de transcription
      - name: Afficher le résultat
        run: cat atis_tallinn.txt

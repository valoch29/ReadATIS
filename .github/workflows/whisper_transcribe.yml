name: Transcription ATIS avec Whisper

on:
  workflow_dispatch:

jobs:
  transcribe-atis:
    runs-on: ubuntu-latest

    steps:
      # 1️⃣ Checkout repository
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2️⃣ Installer Python et Whisper
      - name: Installer Python et Whisper
        run: |
          python3 -m venv venv
          source venv/bin/activate
          pip install --upgrade pip
          pip install git+https://github.com/openai/whisper.git beautifulsoup4

      # 3️⃣ Transcrire l’audio en texte
      - name: Transcrire ATIS
        run: |
          source venv/bin/activate
          whisper atis_tallinn.wav \
            --model small \
            --language English \
            --output_format txt \
            --output_dir .

      # 4️⃣ Renommer la transcription pour toujours avoir le même fichier
      - name: Normaliser nom transcription
        run: |
          mv atis_tallinn.txt atis_tallinn.txt || true

      # 5️⃣ Afficher la transcription dans les logs pour vérification
      - name: Afficher transcription
        run: |
          cat atis_tallinn.txt

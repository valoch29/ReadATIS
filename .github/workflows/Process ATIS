name: 2. Process ATIS (AI)
on:
  workflow_run:
    workflows: ["1. Record ATIS Audio"]
    types: [completed]
  workflow_dispatch:

jobs:
  process:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install AI Tools
        run: pip install faster-whisper

      - name: Run AI & Update HTML
        run: |
          python process_atis.py
          python update_index.py

      - name: Commit & Push Results
        run: |
          git config --global user.name 'ATIS-Processor'
          git config --global user.email 'bot@github.com'
          git fetch origin main
          git reset --mixed origin/main
          git add index.html atis_transcribed.txt
          git commit -m "Update Dashboard $(date)" || exit 0
          git push origin main --force-with-lease
